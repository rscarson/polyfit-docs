---
import BaseLayout from '../layouts/base.astro';
import { includeTestingTutorials } from '../lib/tutorials';
import { prepareMacros } from '../lib/macros';
import Markdown from '../components/markdown.astro';

const testingTutorials = includeTestingTutorials('testing');
const macros = prepareMacros('testing');
---

<BaseLayout title="Testing Guides & Utilities" path="/testing">
    <header id="top" class="page-header">
        <h1>Testing</h1>
        <p class="lead" style="text-align: left;">
            A library of test concepts and guides to help you validate and verify your polynomial fits.
        </p>
    </header>

    <!-- Search box -->
    <div class="mb-4">
        <input type="text" id="glossary-search" class="form-control" placeholder="Search..." />
    </div>
        
    <div class="accordion accordion-flush" style="text-align: left">
        {testingTutorials.map((tutorial: any) => (
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed recipe-card" type="button" data-bs-toggle="collapse"
                        data-bs-target={`#${tutorial.id}`} aria-expanded="false" aria-controls={`${tutorial.id}`}>
                        {tutorial.title}
                    </button>
                </h2>
                <div id={`${tutorial.id}`} class="accordion-collapse collapse no-highlight" data-title={tutorial.title}>
                    <div class="accordion-body">
                        <a href={tutorial.links.github} class="btn btn-outline-secondary btn-sm float-end" target="_blank"><i
                            class="bi bi-github me-2"></i> GitHub
                        </a>

                    <div class="recipe-content">
                        <Markdown items={tutorial.content} p_class="col-md-9" />
                    </div>
                    </div>
                </div>
            </div>
        ))}
    </div>

    <hr />

    <div class="row row-cols-1 row-cols-lg-1 accordion accordion-flush">
        {macros.map((macro: any) => (
        <div class="col accordion-item" style="text-align: left">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed recipe-card" type="button" data-bs-toggle="collapse"
                    data-bs-target={`#${macro.name}`} aria-expanded="false" aria-controls={`${macro.name}`}>
                    <span class="badge text-bg-danger me-2">Macro</span>
                    {macro.prototype}
                </button>
            </h2>
            <div id={`${macro.name}`} class="accordion-collapse collapse no-highlight" data-title={macro.name} >
                <div class="accordion-body">
                    <a href={macro.docs} target="_blank" class="float-end badge text-bg-warning">
                        <i class="bi bi-box-seam me-2"></i> Docs
                    </a>

                    {macro.plot_on_fail && (
                        <div class="alert alert-info" role="alert">
                            <i class="bi bi-info-circle-fill me-2"></i>
                            Generates a plot on failure.
                            <strong>[Requires 'plotting' feature]</strong>
                        </div>
                    )}
                    
                    <Markdown items={macro.desc} p_class="lead col-md-9" />

                    {Object.keys(macro.args).map((arg: any) => (
                        <div class="mb-3 pb-2 border-bottom">
                            <code class="text-primary">{arg}</code>
                            {macro.args[arg].optional && (
                                <span class="badge bg-secondary ms-2">optional</span>
                            )}
                            <div class="mt-1">
                                <Markdown items={macro.args[arg].desc} />
                            </div>
                        </div>
                    ))}

                    <h5>Example</h5>
                    <pre><code class="language-rust" set:html={macro.example}></code></pre>
                </div>
            </div>
        </div>
        ))}
</BaseLayout>